var Bloom=function(e,t,i,o,n){function a(e){var t="visible",i="hidden",o={focus:t,focusin:t,pageshow:t,blur:i,focusout:i,pagehide:i};e=e||window.event,document.body.className=e.type in o?o[e.type]:this[s]?"hidden":"visible"}var s="hidden";s in document?document.addEventListener("visibilitychange",a):(s="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(s="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(s="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?document.onfocusin=document.onfocusout=a:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=a;var t=document.getElementById(t)||document.getElementsByTagName(t)[0],r=0,l=t.offsetWidth-20,h=t.offsetHeight,c=Math.round(-h/4),d=setInterval(function(){if(!document.hidden){if(r++,0!==n&&r>n)return void clearInterval(d);var o=10+Math.floor(Math.random()*l+1),a=document.getElementById(e).cloneNode(!0);a.id="svg"+r,a.style.marginLeft=o+"px";var s=a.getElementsByClassName("tentacles")[0];t.appendChild(a);var h=new TimelineMax({onComplete:function(){a.remove()}});h.to(a,1,{autoAlpha:.999,scale:2},0).to(a,1,{fill:i},1).to(a,3,{y:c},1).to(a,1.5,{autoAlpha:.5},1).to(a,1.5,{autoAlpha:.999},2.5).to(s,.5,{y:0},1).to(s,2,{y:-3},2).to(a,3,{y:2*c}).to(a,1.5,{autoAlpha:.5},4).to(a,1.5,{autoAlpha:.999},5.5).to(s,.5,{y:0},4).to(s,2,{y:-3},5).to(a,3,{y:3*c}).to(a,1.5,{autoAlpha:.5},7).to(a,1.5,{autoAlpha:.999},8.5).to(s,.5,{y:0},7).to(s,2,{y:-3},8).to(a,3,{y:4*c}).to(a,1.5,{autoAlpha:.5},10).to(a,1.5,{autoAlpha:.999},11.5).to(s,.5,{y:0},10).to(s,2,{y:-3},11).to(a,3,{y:5*c}).to(a,1.5,{autoAlpha:.5},13).to(a,1.5,{autoAlpha:.999},14.5).to(s,.5,{y:0},13).to(s,2,{y:-3},14)}},o)},Work=Backbone.Collection.extend({}),Works=Backbone.Collection.extend({model:Work,initialize:function(){_500px.init({sdk_key:"a68318ac6a5a20260bbdbecdd3cf6976c051b84a"}),this.writings=[{id:0,date:"09.13.2014",title:"Redesigning a Redesign of a Redesign",tags:"Personal Essay, Rant",content:"<p>I&apos;ve lost count &mdash; the number of times I&apos;ve redesigned this website must be staggering. It has been an endless cycle of building it partially, completely, only to end up tearing it back down to a blank white page.<br /><br /><em>&quot;Is that all you can do? Certainly there&apos;s something better.&quot;</em><br /><br />The perfectionist in me stirs. It seems as if he knows what he is talking about. It seems as if he has data from scientifically-sound studies on what design is good, bad, or so ridiculously terrible that I should deprive myself of sleep until I figure out a better way to do it. To make it worse, the perfectionist incessantly feeds me examples of other people's accomplishments, constantly reminding me that my work is shoddy at best. Sure, what he does is annoying, and from my description of him, I must&apos;ve made him out to be a goddamn awful prick. On the contrary, he doesn&apos;t mean any harm, at least not in the long term (gulp). He is a parent who enjoys comparing his own kid to the other kids around him. He will tell you other people&apos;s accomplishments, not to make you feel bad about yourself, but to motivate you. At the end of the road, all he wishes for is your eventual 1st place finish, leaving all the other cool kids behind to bite the dust.<br /><br />Sure, there are different styles to parenting out there, but my gut feeling tells me the perfectionist is right. He is right in the sense that his style of teaching fits with my style of learning, like two jigsaw pieces interlocking flawlessly to form the organism that is currently writing this strange piece comparing himself to a 2-piece jigsaw puzzle set. I should add the stale-smelling cardboard box and the bargain price sticker as well, but I digress.<br /><br />He and I will live on as one and learn from each other. He will be my life-long partner, forever feeding me new ideas and reminding me of how much I suck. I, too, will play the role of his partner, forever playing catch-up and making him feel bigger than he really is. <em>Symbiosis at work</em>. Together, we have some tremendous challenges ahead of us. With technological advancements setting the rapid cadence, we will inevitably be exposed to newer, shinier, arguably better things. It has actually gotten quite difficult to fathom the speed at which other people are creating now. Nonetheless, whatever they are up to, we will be right there beside them, tumbling and climbing over each others&apos; shoulders, continuously feeding back into a massive human pyramid.<br/><br />In the eyes of the viewer, this website was version 1.0, and now it is version 2.0. Little did they know that, along the way, there was a 1.1, 1.2, 1.3, 1.34, 1.39...<br /><br />This has been an insanely difficult first step.</p>"}]},fetchWritings:function(e,t){e.append(t({works:this.writings}))},fetchPhotos:function(e,t){var i=this;i.photos=[],_500px.api("/photos",{feature:"user",username:"kzmeyao",image_size:"4",sort:"taken_at"},function(o){o.success?($.each(o.data.photos,function(e,t){t.taken_at=t.taken_at.substring(0,10).replace(/-/g,"."),t.width>t.height&&i.photos.push(t)}),e.append(t({works:i.photos})),"hello"==Backbone.history.fragment&&TweenLite.to(window,.5,{scrollTo:{y:$(".hello-view").offset().top-80}})):console.log("Unable to complete request: "+o.status+" - "+o.error_message)})}}),CloudView=Backbone.View.extend({events:{"click .icon-cancel":"close","click #wrapper":"close"},initialize:function(e){this.template=Handlebars.compile($("#cloud-template").html()),this.photoTemplate=Handlebars.compile($("#photo-template").html()),this.writingTemplate=Handlebars.compile($("#writing-template").html()),this.photos=e.works.photos,this.writings=e.works.writings,this.ratio=598/900},render:function(e,t){this.$el.addClass("cloudy"),this.$el.append(this.template());var i=$(".cloud"),o=new TimelineLite,n=this;o.to(i,.3,{autoAlpha:.99}).to(i,.3,{y:"-20",onComplete:function(){"photo"==e?(i.append(n.photoTemplate()),0===n.photos.length?_500px.api("/photos",{feature:"user",username:"kzmeyao",image_size:"4",sort:"taken_at"},function(e){e.success?($.each(e.data.photos,function(e,t){t.width>t.height&&n.photos.push(t)}),n.startTheShowFrom(t)):console.log("Unable to complete request: "+e.status+" - "+e.error_message)}):n.startTheShowFrom(t)):"writing"==e&&n.startTheBookFrom(t)}},"-=0.3")},startTheBookFrom:function(e){var t=this;$.each(this.writings,function(i,o){o.id==e&&(t.index=i)}),$(".cloud").append(this.writingTemplate(this.writings[this.index]))},startTheShowFrom:function(e){var t=this,i=[],o=$("body").width();this.w=o>900?900:o,this.h=this.w*this.ratio,$.each(this.photos,function(o,n){i.push({img:n.image_url,width:t.w,height:t.h,id:n.id}),n.id==e&&(t.index=o)});var n=i.slice(0,this.index),a=i.slice(this.index);i=a.concat(n);var s,r,l,h;for(s=new SwipeView("#wrapper",{numberOfPages:i.length}),l=0;3>l;l++)h=0==l?i.length-1:l-1,r=document.createElement("img"),r.className="loading",r.src=i[h].img,r.width=i[h].width,r.height=i[h].height,r.setAttribute("data-id",i[h].id),r.onload=function(){this.className=""},s.masterPages[l].appendChild(r);s.onFlip(function(){App.navigate("photo/"+$(".swipeview-active img").data("id"));var e,o,n;for(n=0;3>n;n++)o=s.masterPages[n].dataset.upcomingPageIndex,o!=s.masterPages[n].dataset.pageIndex&&(e=s.masterPages[n].querySelector("img"),e.className="loading",e.src=i[o].img,e.width=t.w,e.height=t.h,e.setAttribute("data-id",i[o].id))}),s.onMoveOut(function(){s.masterPages[s.currentMasterPage].className=s.masterPages[s.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"")}),s.onMoveIn(function(){var e=s.masterPages[s.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(e)||(s.masterPages[s.currentMasterPage].className=e?e+" swipeview-active":"swipeview-active")}),$(window).resize(function(){var e=$("body").width();t.w=e>900?900:e,t.h=t.w*t.ratio;var i=$(".cloud img");$.each(i,function(e,i){i.setAttribute("width",t.w),i.setAttribute("height",t.h)})})},close:function(e){if("IMG"!=e.target.tagName&&"P"!=e.target.tagName){$(window).off("resize");var t=$(".cloud"),i=new TimelineLite;$("#wrapper").remove();var o=this;i.to(t,.3,{autoAlpha:0}).to(t,.3,{y:"20",onComplete:function(){o.$el.removeClass("cloudy"),o.$el.find(".cloud").remove()}},"-=0.3"),App.navigate("works")}}}),WorksView=Backbone.View.extend({events:{"click .photos img":"renderPhotoCloud","click .writings li":"renderWritingCloud"},initialize:function(){this.writingsTemplate=Handlebars.compile($("#works-view-writings-template").html()),this.photosTemplate=Handlebars.compile($("#works-view-photos-template").html()),this.collection=new Works},render:function(){this.collection.fetchWritings(this.$el,this.writingsTemplate),this.collection.fetchPhotos(this.$el,this.photosTemplate)},remove:function(){this.$el.empty()},renderPhotoCloud:function(e){App.navigate("photo/"+$(e.currentTarget).data("id"),{trigger:!0})},renderWritingCloud:function(e){App.navigate("writing/"+$(e.currentTarget).data("id"),{trigger:!0})},renderCloud:function(e,t){this.cloud||(this.cloud=new CloudView({el:"body",works:this.collection})),this.cloud.render(e,t)}}),HelloView=Backbone.View.extend({events:{},initialize:function(){this.template=Handlebars.compile($("#hello-view-template").html())},render:function(){this.$el.append(this.template())}}),OceanView=Backbone.View.extend({events:{"click .nav-works":"goWork","click .nav-hello":"sayHello","click .logo":"goHome","mouseover .logo":"logoHover","click button":"unleash"},initialize:function(){},render:function(){var e=new Image;e.src="../images/splash.jpg",e.onload=function(){$(".backgroundsize header").css("background","url("+e.src+") no-repeat center 75% scroll").css("background-size","cover");var t=$("#jelly"),i=new TimelineLite;i.to(t,1,{scale:2.5}).to(t,1,{autoAlpha:1})}},logoHover:function(e){if(!this.hovering){var t=this;t.hovering=!0;var i=$(e.currentTarget).find(".tentacles"),o=new TimelineLite;o.to(i,.7,{y:"-2.5",ease:Circ.easeIn}).to(i,.7,{y:"0",ease:Circ.easeOut,onComplete:function(){t.hovering=!1}})}},unleash:function(){TweenLite.to($(".welcome button"),1,{autoAlpha:0,y:-10}),new Bloom("jelly-hidden","header","#ffffff",1200,1e3)},goHome:function(){""===Backbone.history.fragment?Backbone.history.loadUrl(Backbone.history.fragment):App.navigate("",{trigger:!0})},goWork:function(){"works"===Backbone.history.fragment?Backbone.history.loadUrl(Backbone.history.fragment):App.navigate("works",{trigger:!0})},sayHello:function(){"hello"===Backbone.history.fragment?Backbone.history.loadUrl(Backbone.history.fragment):App.navigate("hello",{trigger:!0})}}),TheWorldView=Backbone.View.extend({events:{},initialize:function(){$("header").css({height:$(window).height()}),$("header>.overlay").css({height:$(window).height()}),this.ocean=new OceanView({el:"header"});var e=this,t=function(){e.didScroll=!0};$(window).scroll(t),this.scrollInterval=setInterval(function(){if(e.didScroll){e.didScroll=!1;var t=$("nav .overlay"),i=$(window).scrollTop(),o=$("header").outerHeight();e.persist&&o>i?(e.persist=!1,TweenLite.to(t,.3,{height:"8%"})):!e.persist&&i>o&&(e.persist=!0,TweenLite.to(t,.3,{height:"100%"}));var n=$(".lazy-img");n&&$.each(n,function(e,t){var i=t.getBoundingClientRect();i.top>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)+500&&(t.className="loaded-img",t.src=t.getAttribute("data-src"))})}},250),this.worksView=new WorksView({el:".works-view"}),this.helloView=new HelloView({el:".hello-view"})},render:function(){this.ocean.render(),this.worksView.render(),this.helloView.render()},goHome:function(){TweenLite.to(window,.5,{scrollTo:{y:0,x:0}})},goWork:function(){TweenLite.to(window,.5,{scrollTo:{y:$(".works-view").offset().top-80}})},sayHello:function(){TweenLite.to(window,.5,{scrollTo:{y:$(".hello-view").offset().top-80}})},writeSomething:function(e){this.worksView.renderCloud("writing",e)},takePicture:function(e){this.worksView.renderCloud("photo",e)}}),AppRouter=Backbone.Router.extend({routes:{"":"home",works:"works",hello:"hello","writing/:id":"writing","photo/:id":"photo"},home:function(){this.view||(this.view=new TheWorldView({el:"body"}),this.view.render()),this.view.goHome()},works:function(){this.view||(this.view=new TheWorldView({el:"body"}),this.view.render()),this.view.goWork()},hello:function(){this.view||(this.view=new TheWorldView({el:"body"}),this.view.render()),this.view.sayHello()},writing:function(e){this.view||(this.view=new TheWorldView({el:"body"}),this.view.render()),this.view.writeSomething(e)},photo:function(e){this.view||(this.view=new TheWorldView({el:"body"}),this.view.render()),this.view.takePicture(e)}}),App=new AppRouter;Backbone.history.start();